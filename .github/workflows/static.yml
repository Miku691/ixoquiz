name: Pre-render AngularJS

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Install dependencies
      run: npm install

    - name: Pre-render with Puppeteer
      run: |
        node -e "
        const puppeteer = require('puppeteer');
        const fs = require('fs');
        const path = require('path');
        (async () => {
          const browser = await puppeteer.launch({ args: ['--no-sandbox', '--disable-setuid-sandbox'] });
          const page = await browser.newPage();
          const routes = ['/', '/about', '/contact']; // Add your routes here
          for (const route of routes) {
            await page.goto(\`https://miku691.github.io/ixoquiz${route}\`, { waitUntil: 'networkidle0' });
            const content = await page.content();
            const filePath = path.join(__dirname, 'dist', route === '/' ? 'index.html' : \`\${route}.html\`);
            fs.mkdirSync(path.dirname(filePath), { recursive: true });
            fs.writeFileSync(filePath, content);
          }
          await browser.close();
        })();
        "

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
